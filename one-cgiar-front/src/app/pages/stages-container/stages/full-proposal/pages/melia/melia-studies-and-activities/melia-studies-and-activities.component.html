<section-title name="Melia studies and activities"></section-title>

<div class="section-container animate__animated animate__fadeIn">

    <div class="alert_container" style="margin: 20px 0 35px 0;">
        <ibdc-alert [options]="{text: 'If you are planning to carry out the same study in different years, please report every MELIA study separately.', type:'info'}"></ibdc-alert>
    </div>
    <div style="padding-bottom: 2em;">
        <app-compact-information-table-view (buttonViewEvent)="this.getTabIndex($event)"
            (onEdit)="this.getItemToExpand($event)" [list]="this.list" [attr_list_config]="this.attr_list_config"
            [showTableViewVariable]="this.showTableViewVariable"></app-compact-information-table-view>
    </div>


    <h1 style="text-align: center;" *ngIf="!this.list?.length && this._initiativesService.initiative.readonly">No data
    </h1>

    <div class="items animate__animated animate__fadeIn" *ngIf="!showTableViewVariable">
        <div class="item" *ngFor="let item of list; let i=index">


            <app-collapsible-container [collapse]="item?.collapse">
                <div header>Melia studies and activity {{i+1}}</div>
                <div content>
                    <app-button-edit-or-delete *ngIf="!this._initiativesService.initiative.readonly"
                        [ngCustomStyle]="{'margin-top':'12px'}" type="delete" (action)="deleteItem(item, i)"
                        [confirmDeleteModal]="true"></app-button-edit-or-delete>
                    <br><br>
                    <div class="fields">

                        <div class="alert_container" style="margin: 20px 0 35px 0;">
                            <ibdc-alert [options]="{text: 'If there is no item in the list, it is probably because information is missing in the TOC (Click here to go to edit toc).', type:'info'}"></ibdc-alert>
                        </div>

                        <div class="mb-4">
                            <ibdc-select-field class="field"
                                [readOnlyVariable]="this._initiativesService.initiative.readonly" [objectItem]="item"
                                [objectAtributteName]="'type_melia'" [objectAtributteId]="'type_melia_id'"
                                [inputTitle]="this.attr_list_config[1].name" selectableListAtributteName='name'
                                selectableListAtributteId='id' [selectableList]="this.meliaStudyTypes"
                                frontendSearchAttribute="name">
                            </ibdc-select-field>
                        </div>
                        <div class="mb-4" *ngIf="item.type_melia_id == 8">
                            <ibdc-text-area-field inputTitle="Specify the MELIA study or activity" [objectItem]="item"
                                [objectAtributteName]="'other_melia'"
                                [readOnlyVariable]="this._initiativesService?.initiative.readonly" [maxWords]="50">
                            </ibdc-text-area-field>
                        </div>

                        <ibdc-text-area-field [inputTitle]="this.attr_list_config[2].name" [objectItem]="item"
                            [objectAtributteName]="this.attr_list_config[2].attribute"
                            [readOnlyVariable]="this._initiativesService?.initiative.readonly" [maxWords]="50">
                        </ibdc-text-area-field>
                        <ibdc-simple-text [options]="{inputTitle:this.attr_list_config[2].name,value: item[this.attr_list_config[2].attribute], required: false}" textAlign='justify'></ibdc-simple-text>

                        <ibdc-select-multiple *ngIf="item.resultsByMeliaList" (onSelectOptionE)="resultToHtml()" [options]="{
                            inputTitle:'TOC EOI Outcomes, WP Outcomes, WP Outputs',
                            selectList:item.resultsByMeliaList,
                            selectItemName:'fullResultTitle',
                            selectItemId:'resultId',
                            selectItemNameBold:'wpName',
                            intermediateText:'- WP:',
                            hideSavedList: true,
                            shadow: false,
                            frontendSearchAttribute:'fullResultTitle',
                            readOnlyVariable: this._initiativesService.initiative.readonly,
                            savedList:{
                                list: item.selectResults,
                                selectItemId:'resultId',
                                selectItemName:'resultTitle',
                                idToSave:'id',
                                labelName:'resultTitle'
                            }
                        }"></ibdc-select-multiple>

                        <div class="items_container" *ngIf="checkActives(item.selectResults)">
                            <div class="items">
                                <div>
                                    <div *ngFor="let item of item.selectResults">
                                        <app-multiple-select-item [object]="item" [attr]="'resultTitle'"></app-multiple-select-item>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <ibdc-select-multiple [options]="{
                            inputTitle:'Choose multiple depth scale',
                            selectList: this.depthScalesList,
                            selectItemName:'depthScaleName',
                            selectItemId:'depthScaleId',
                            hideSavedList: true,
                            shadow: false,
                            frontendSearchAttribute:'acronym_name',
                            readOnlyVariable: this._initiativesService.initiative.readonly,
                            savedList:{
                                list: this.indicatorsListPOBSavediItem.depthScaleList,
                                selectItemId:'depthScaleId',
                                selectItemName:'depthScaleName',
                                idToSave:'depthScaleId',
                                labelName:'depthScaleName'
                            }
                        }"></ibdc-select-multiple> -->

                        <div class="mb-4">
                            <ibdc-select-field class="field"
                                [readOnlyVariable]="this._initiativesService.initiative.readonly" [objectItem]="item"
                                [objectAtributteName]="'anticipated_year_completion'"
                                [objectAtributteId]="'anticipated_year_completion'"
                                [inputTitle]="this.attr_list_config[3].name" selectableListAtributteName='year'
                                selectableListAtributteId='year' [selectableList]="this.years"
                                frontendSearchAttribute="year">
                            </ibdc-select-field>
                        </div>

                        <ibdc-text-area-field [inputTitle]="this.attr_list_config[5].name" [objectItem]="item"
                            [objectAtributteName]="this.attr_list_config[5].attribute"
                            [readOnlyVariable]="this._initiativesService?.initiative.readonly" [maxWords]="50">
                        </ibdc-text-area-field>

                        <ibdc-select-multiple [options]="{
                            required: null,
                            inputTitle: this.attr_list_config[4].name,
                            selectItemName:'displayName',
                            selectItemId:'initiativeId',
                            frontendSearchAttribute:'displayName',
                            readOnlyVariable: this._initiativesService.initiative.readonly,
                            description: 'Message',
                            savedList:{
                                list:item.initiatives,
                                selectItemName:'displayName',
                                selectItemId:'initiativeId',
                                idToSave:'id',
                                labelName:'initiatives'
                            },
                            service:{
                                serviceTS:this._initiativesService,
                                functionName:'getInitiativesList',
                                objectName:['response','initiatives']
                            }
                           }"></ibdc-select-multiple>

                        <div class="col-sm-12">
                            <app-geographic-scope [localForm]="this.geographicScopes[i]"
                                [regionsSelectedList]="item.regions" [countriesSelectedList]="item.countries" [subject]="'MELIA Study'">
                            </app-geographic-scope>
                        </div>
                    </div>
                </div>
            </app-collapsible-container>



        </div>
    </div>

    <div style="margin-top: 20px;" *ngIf="!this._initiativesService.initiative.readonly">
        <app-add-button name="Add Melia studies and activity" (click)="addItem()"></app-add-button>
    </div>


    <div class="justify_content_end" *ngIf="!_initiativesService.initiative.readonly" (click)="saveSection()">
        <ibdc-save-button
            [options]="{readOnlyVariable: this._initiativesService.initiative.readonly,remember:true, minutesToRemember: this._dataControlService.minutesToRemeberSave}">
        </ibdc-save-button>
    </div>

</div>